<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ObedovÃ© Menu - Kreston Slovakia</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #00274d;
            --navy-mid: #003d75;
            --accent: #e8a020;
            --light-bg: #f4f7fb;
            --card-bg: #ffffff;
            --text: #1a2535;
            --muted: #6b7e96;
            --border: #dce4ef;
            --success: #2e7d32;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--light-bg);
            color: var(--text);
            min-height: 100vh;
            padding: 24px 16px 48px;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
        }

        /* â”€â”€ Header â”€â”€ */
        .header {
            text-align: center;
            padding: 48px 32px 40px;
            background: var(--navy);
            border-radius: 20px;
            margin-bottom: 32px;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at 70% 50%, rgba(232,160,32,0.12) 0%, transparent 60%),
                        radial-gradient(ellipse at 20% 80%, rgba(0,100,200,0.15) 0%, transparent 50%);
        }
        .header > * { position: relative; z-index: 1; }

        .company-badge {
            display: inline-block;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.8);
            font-size: 0.75em;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 5px 14px;
            border-radius: 20px;
            margin-bottom: 18px;
        }

        h1 {
            font-family: 'DM Serif Display', serif;
            color: #fff;
            font-size: clamp(2em, 5vw, 3.2em);
            font-weight: 400;
            line-height: 1.15;
            margin-bottom: 8px;
        }

        .header-sub {
            color: rgba(255,255,255,0.55);
            font-size: 0.9em;
            margin-bottom: 28px;
            letter-spacing: 0.3px;
        }

        .today-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--accent);
            color: var(--navy);
            font-weight: 600;
            font-size: 0.95em;
            padding: 8px 20px;
            border-radius: 30px;
            margin-bottom: 24px;
        }

        .btn {
            background: #fff;
            color: var(--navy);
            border: none;
            padding: 13px 30px;
            font-size: 0.95em;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.2); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* â”€â”€ Grid â”€â”€ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
        }

        /* â”€â”€ Card â”€â”€ */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 2px 16px rgba(0,39,77,0.08);
            overflow: hidden;
            transition: box-shadow 0.2s;
        }
        .card:hover { box-shadow: 0 6px 28px rgba(0,39,77,0.14); }

        .card-head {
            background: var(--navy);
            padding: 18px 22px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .rest-name {
            color: #fff;
            font-weight: 600;
            font-size: 1.05em;
        }

        .visit-btn {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 0.8em;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.25);
            padding: 5px 12px;
            border-radius: 6px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .visit-btn:hover { background: rgba(255,255,255,0.15); color: #fff; }

        .card-body { padding: 20px 22px; }

        /* â”€â”€ Menu items â”€â”€ */
        .menu-date {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85em;
            font-weight: 500;
            color: var(--navy-mid);
            background: #eef4ff;
            border-radius: 8px;
            padding: 8px 14px;
            margin-bottom: 16px;
        }

        .section-title {
            font-weight: 600;
            font-size: 0.75em;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--muted);
            margin: 20px 0 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
        }
        .section-title:first-of-type { margin-top: 0; }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f4f8;
        }
        .menu-item:last-child { border-bottom: none; }

        .dish-name {
            flex: 1;
            font-size: 0.93em;
            line-height: 1.5;
            color: var(--text);
        }

        .price {
            font-weight: 600;
            font-size: 0.95em;
            color: var(--navy);
            white-space: nowrap;
        }

        /* â”€â”€ States â”€â”€ */
        .spinner-wrap { text-align: center; padding: 40px 20px; }
        .spinner {
            width: 28px; height: 28px;
            border: 3px solid var(--border);
            border-top-color: var(--navy);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 12px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner-label { color: var(--muted); font-size: 0.9em; }

        .error-box {
            background: #fff8e1;
            border-left: 3px solid var(--accent);
            border-radius: 8px;
            padding: 14px 16px;
            font-size: 0.88em;
            color: #5a4200;
        }
        .error-box button {
            margin-top: 10px;
            background: var(--navy);
            color: #fff;
            border: none;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-family: 'DM Sans', sans-serif;
        }
        .no-menu { text-align: center; color: var(--muted); padding: 30px 0; font-size: 0.9em; }

        .footer {
            text-align: center;
            margin-top: 36px;
            color: var(--muted);
            font-size: 0.82em;
        }
        .updated { margin-top: 8px; }

        @media (max-width: 820px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="container">

    <div class="header">
        <div class="company-badge">Kreston Slovakia</div>
        <h1>ObedovÃ© Menu</h1>
        <p class="header-sub">Lunch Break Â· Foodgarden Pressburg Â· Foodgarden Apollo</p>
        <div class="today-badge" id="todayBadge">ğŸ“… â€”</div><br>
        <button class="btn" onclick="fetchAllMenus()" id="fetchBtn">ğŸ”„ NaÄÃ­taj vÅ¡etky menu</button>
    </div>

    <div class="grid">
        <!-- Lunch Break -->
        <div class="card">
            <div class="card-head">
                <div class="rest-name">ğŸ´ Lunch Break</div>
                <a href="https://www.lunch-break.sk/menu-apollo/" target="_blank" class="visit-btn">OtvoriÅ¥ â†’</a>
            </div>
            <div class="card-body" id="lb-content"><div class="spinner-wrap"><div class="spinner"></div><div class="spinner-label">NaÄÃ­tavam...</div></div></div>
        </div>

        <!-- Foodgarden Pressburg -->
        <div class="card">
            <div class="card-head">
                <div class="rest-name">ğŸŒ¿ Foodgarden Pressburg</div>
                <a href="https://pressburg.foodgarden.sk/denne-menu-foodgarden-pressburg/" target="_blank" class="visit-btn">OtvoriÅ¥ â†’</a>
            </div>
            <div class="card-body" id="fp-content"><div class="spinner-wrap"><div class="spinner"></div><div class="spinner-label">NaÄÃ­tavam...</div></div></div>
        </div>

        <!-- Foodgarden Apollo -->
        <div class="card">
            <div class="card-head">
                <div class="rest-name">ğŸ›ï¸ Foodgarden Apollo</div>
                <a href="https://apollo.foodgarden.sk/" target="_blank" class="visit-btn">OtvoriÅ¥ â†’</a>
            </div>
            <div class="card-body" id="fa-content"><div class="spinner-wrap"><div class="spinner"></div><div class="spinner-label">NaÄÃ­tavam...</div></div></div>
        </div>
    </div>

    <div class="footer">
        <div class="updated" id="updatedTime"></div>
        Kreston Slovakia â€“ ObedovÃ© Menu
    </div>
</div>

<script>
// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const SK_DAYS = ['NedeÄ¾a','Pondelok','Utorok','Streda','Å tvrtok','Piatok','Sobota'];

function todayName() { return SK_DAYS[new Date().getDay()]; }
function todayDate() {
    const d = new Date();
    return `${String(d.getDate()).padStart(2,'0')}.${String(d.getMonth()+1).padStart(2,'0')}.${d.getFullYear()}`;
}
function fullDate() { return `${todayName()} ${todayDate()}`; }

document.getElementById('todayBadge').textContent = `ğŸ“… ${fullDate()}`;

// CORS proxies â€” tried in order, first success wins
const PROXIES = [
    url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
    url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
    url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
    url => `https://thingproxy.freeboard.io/fetch/${url}`,
    url => `https://jsonp.afeld.me/?url=${encodeURIComponent(url)}`,
];

async function fetchHTML(url, timeoutMs = 8000) {
    for (const makeProxy of PROXIES) {
        try {
            const ctrl = new AbortController();
            const timer = setTimeout(() => ctrl.abort(), timeoutMs);
            const res = await fetch(makeProxy(url), { signal: ctrl.signal });
            clearTimeout(timer);
            if (!res.ok) continue;
            const text = await res.text();
            if (text && text.length > 200) return text;
        } catch (_) { /* try next */ }
    }
    throw new Error('VÅ¡etky proxy servery zlyhali');
}

function dateHeader() {
    return `<div class="menu-date">ğŸ“… ${fullDate()}</div>`;
}

function renderItems(sections) {
    let html = '';
    let hasAny = false;
    for (const [title, items] of sections) {
        if (!items.length) continue;
        hasAny = true;
        html += `<div class="section-title">${title}</div>`;
        items.forEach(({name, price}) => {
            html += `<div class="menu-item">
                <div class="dish-name">${name}</div>
                <div class="price">${price}</div>
            </div>`;
        });
    }
    return hasAny ? html : '<div class="no-menu">Menu pre dneÅ¡nÃ½ deÅˆ nie je dostupnÃ©.</div>';
}

function errorHTML(retryFn) {
    return `<div class="error-box">
        âš ï¸ Menu sa nepodarilo naÄÃ­taÅ¥. SkÃºste otvoriÅ¥ strÃ¡nku reÅ¡taurÃ¡cie priamo.
        <br><button onclick="${retryFn}()">ğŸ”„ SkÃºsiÅ¥ znova</button>
    </div>`;
}

// â”€â”€ Lunch Break â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function fetchLunchBreak() {
    const el = document.getElementById('lb-content');
    el.innerHTML = '<div class="spinner-wrap"><div class="spinner"></div><div class="spinner-label">NaÄÃ­tavam...</div></div>';
    try {
        const html = await fetchHTML('https://www.lunch-break.sk/menu-apollo/');
        const doc = new DOMParser().parseFromString(html, 'text/html');

        const sections = new Map([
            ['ğŸ¥£ Polievky', []],
            ['ğŸ– MÃ¤sovÃ© menu', []],
            ['ğŸ¥— BezmÃ¤sitÃ© menu', []],
            ['â­ Å peciÃ¡l menu', []],
        ]);

        let cur = null;

        // Try structured table/list approach first
        const rows = doc.querySelectorAll('table tr, .menu-item, .menu_item, [class*="menu"] li');
        if (rows.length > 0) {
            rows.forEach(row => {
                const cells = row.querySelectorAll('td, th');
                if (cells.length >= 2) {
                    const name = cells[0].textContent.trim();
                    const priceCell = cells[cells.length - 1].textContent.trim();
                    const priceMatch = priceCell.match(/\d+[.,]\d+\s*â‚¬/);
                    if (name && priceMatch && name.length > 3) {
                        (sections.get('ğŸ– MÃ¤sovÃ© menu') || []).push({ name, price: priceMatch[0] });
                    }
                }
            });
        }

        // Fallback: paragraph/text parsing
        if (![...sections.values()].some(a => a.length)) {
            const els = doc.querySelectorAll('p, strong, h3, h4, h5, li, div');
            els.forEach(e => {
                const raw = e.textContent.trim();
                if (!raw || raw.length < 3) return;
                const up = raw.toUpperCase();

                if (up.match(/^POLIEVK/) && !up.includes('V CENE')) { cur = 'ğŸ¥£ Polievky'; return; }
                if (up.match(/MÃ„SOVÃ‰ MENU|MÃ„SITÃ‰ MENU/)) { cur = 'ğŸ– MÃ¤sovÃ© menu'; return; }
                if (up.match(/BEZMÃ„SITÃ‰ MENU|BEZMASÃ‰/)) { cur = 'ğŸ¥— BezmÃ¤sitÃ© menu'; return; }
                if (up.match(/Å PECIÃL|SPECIAL MENU/)) { cur = 'â­ Å peciÃ¡l menu'; return; }

                // Soup names: "Polievka: SlepaÄÃ­ vÃ½var / ParadajkovÃ¡"
                if (cur === 'ğŸ¥£ Polievky' && raw.includes('/')) {
                    raw.split('/').map(s => s.replace(/polievka/gi,'').replace(/:/,'').trim()).filter(s => s.length > 3).forEach(s => {
                        sections.get('ğŸ¥£ Polievky').push({ name: s, price: 'v cene menu' });
                    });
                    cur = null;
                    return;
                }

                if (!cur) return;

                // "A, KuracÃ­ rezeÅˆ ... 6.50 â‚¬"
                const m1 = raw.match(/^([A-Z]),?\s+(.+?)\s+(\d+[.,]\d+)\s*â‚¬/);
                if (m1) {
                    sections.get(cur)?.push({ name: `${m1[1]}. ${m1[2]}`, price: `${m1[3].replace(',','.')} â‚¬` });
                    return;
                }
                // generic price in line
                const m2 = raw.match(/^(.+?)\s{2,}(\d+[.,]\d+)\s*â‚¬/);
                if (m2 && m2[1].length > 3 && !m2[1].toUpperCase().match(/MENU|POLIEVKA/)) {
                    sections.get(cur)?.push({ name: m2[1].trim(), price: `${m2[2].replace(',','.')} â‚¬` });
                }
            });
        }

        el.innerHTML = dateHeader() + renderItems(sections);
    } catch(err) {
        console.error('LunchBreak:', err);
        el.innerHTML = errorHTML('fetchLunchBreak');
    }
}

// â”€â”€ Foodgarden shared parser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function parseFoodgarden(doc) {
    const day = todayName().toUpperCase();
    const sections = new Map([
        ['ğŸ½ï¸ DennÃ© menu', []],
        ['ğŸŒ± VegÃ¡nske menu', []],
        ['ğŸ“‹ StÃ¡la ponuka', []],
    ]);

    // Strategy 1: look for tab/section matching today's day name
    let target = null;

    // Try headings
    for (const h of doc.querySelectorAll('h2,h3,h4,[class*="tab-title"],[class*="day"]')) {
        if (h.textContent.trim().toUpperCase().includes(day) ||
            h.textContent.trim().toUpperCase().includes('DNES')) {
            target = h.closest('section, article, [class*="tab"], [class*="panel"]') ||
                     h.parentElement?.parentElement || h.parentElement;
            break;
        }
    }

    // Strategy 2: search entire body if no target
    const scope = target || doc.body;

    let cur = 'ğŸ½ï¸ DennÃ© menu';
    let inToday = !target; // if no scoped target, scan all and detect day

    const allEls = scope.querySelectorAll('h2,h3,h4,h5,p,li,[class*="menu-item"],[class*="dish"],[class*="food"]');

    allEls.forEach(el => {
        const raw = el.textContent.trim();
        if (!raw || raw.length < 2) return;
        const up = raw.toUpperCase();

        // Day boundary detection (when no target found)
        if (!target) {
            const isDay = /^(PONDELOK|UTOROK|STREDA|Å TVRTOK|PIATOK|SOBOTA|NEDEÄ½A)/.test(up);
            if (isDay) {
                inToday = up.startsWith(day);
                return;
            }
        }
        if (!inToday && !target) return;

        // Section detection
        if (up.includes('VEGÃN') || up.includes('VEGAN')) { cur = 'ğŸŒ± VegÃ¡nske menu'; return; }
        if (up.includes('STÃLA PONUKA') || up.includes('STALA PONUKA')) { cur = 'ğŸ“‹ StÃ¡la ponuka'; return; }
        if (up.includes('DENNÃ‰ MENU') || up.includes('DENNE MENU')) { cur = 'ğŸ½ï¸ DennÃ© menu'; return; }

        // Price detection: look for sibling/nearby h5 price or inline price
        const parent = el.closest('[class*="item"],[class*="dish"],[class*="menu"]') || el.parentElement;
        const priceEl = parent?.querySelector('h5,[class*="price"]');

        let name = '', price = '';

        if (priceEl && priceEl !== el) {
            name = raw.split(/Objem:|HmotnosÅ¥:|AlergÃ©n/)[0].trim();
            price = priceEl.textContent.trim();
        } else {
            // inline: "SlepaÄÃ­ vÃ½var 1.20 â‚¬"
            const m = raw.match(/^(.+?)\s{2,}(\d+[.,]\d+\s*â‚¬)/);
            if (m) { name = m[1].trim(); price = m[2].trim(); }
        }

        if (name && name.length > 3 && price &&
            !name.toUpperCase().match(/^(VEGÃN|STÃLA|DENNÃ‰|ALERGÃ‰N|OBJEM|HMOT)/) &&
            price.match(/\d/)) {
            sections.get(cur)?.push({ name, price });
        }
    });

    return sections;
}

async function fetchFoodgardenPressburg() {
    const el = document.getElementById('fp-content');
    el.innerHTML = '<div class="spinner-wrap"><div class="spinner"></div><div class="spinner-label">NaÄÃ­tavam...</div></div>';
    try {
        const html = await fetchHTML('https://pressburg.foodgarden.sk/denne-menu-foodgarden-pressburg/');
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const sections = parseFoodgarden(doc);
        el.innerHTML = dateHeader() + renderItems(sections);
    } catch(err) {
        console.error('FG Pressburg:', err);
        el.innerHTML = errorHTML('fetchFoodgardenPressburg');
    }
}

async function fetchFoodgardenApollo() {
    const el = document.getElementById('fa-content');
    el.innerHTML = '<div class="spinner-wrap"><div class="spinner"></div><div class="spinner-label">NaÄÃ­tavam...</div></div>';
    try {
        const html = await fetchHTML('https://apollo.foodgarden.sk/');
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const sections = parseFoodgarden(doc);
        el.innerHTML = dateHeader() + renderItems(sections);
    } catch(err) {
        console.error('FG Apollo:', err);
        el.innerHTML = errorHTML('fetchFoodgardenApollo');
    }
}

// â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function fetchAllMenus() {
    const btn = document.getElementById('fetchBtn');
    btn.disabled = true;
    btn.textContent = 'â³ NaÄÃ­tavam...';

    await Promise.all([
        fetchLunchBreak(),
        fetchFoodgardenPressburg(),
        fetchFoodgardenApollo(),
    ]);

    btn.disabled = false;
    btn.textContent = 'ğŸ”„ NaÄÃ­taj vÅ¡etky menu';

    const now = new Date();
    document.getElementById('updatedTime').textContent =
        `AktualizovanÃ©: ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
}

fetchAllMenus();
</script>
</body>
</html>
